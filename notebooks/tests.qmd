---
title: "Moving price graph"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
from src.jp_imports.data_process import DataTrade
from src.jp_imports.data_pull import DataPull
from polars.testing import assert_frame_equal
import polars as pl
import ibis

ibis.options.interactive = True

d = DataPull("sqlite:///test.sqlite",debug=True, dev=True)
d1 = DataTrade("sqlite:///test.sqlite", debug=True, dev=True)
conn = ibis.sqlite.connect("test.sqlite")
```

```{python}
d.insert_int_jp("test/test_inserts/jp_data_sample.parquet", "data/external/code_agr.json")
d.insert_int_org("test/test_inserts/org_data_sample.parquet")
```

```{python}
conn.table("inttradedata").to_parquet("test/test_inserts/test_org_data.parquet")
```

```{python}
time = "yearly"
types = "total"
df = d1.process_int_org(time, types, agr=True)
df.to_polars()
```
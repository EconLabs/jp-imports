---
title: "Agriculture processing"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```


```{python}
import polars as pl
from src.data.data_pull import DataPull

dp = DataPull()

```

```{python}
dp.insert_int_org()
dp.conn.sql("SELECT * FROM 'inttradedata';").df()
```

```{python}
dp.insert_int_jp()
dp.conn.sql("SELECT * FROM 'jptradedata';").df()
```

```{python}
agri_prod = pl.read_json(
                f"data/external/code_agr.json"
            ).transpose()
agri_prod = (
    agri_prod.with_columns(pl.nth(0).cast(pl.String).str.zfill(4))
    .to_series()
    .to_list()
)
jp_df = pl.read_parquet(f"data/raw/jp_data.parquet")
jp_df = jp_df.rename(
    {col: col.lower() for col in jp_df.collect_schema().names()}
)
jp_df = jp_df.with_columns(
                date=pl.col("year").cast(pl.String)
                + "-"
                + pl.col("month").cast(pl.String)
                + "-01",
                unit_1=pl.col("unit_1").str.to_lowercase(),
                unit_2=pl.col("unit_2").str.to_lowercase(),
                hts_code=pl.col("commodity_code")
                .cast(pl.String)
                .str.zfill(10)
                .str.replace("'", ""),
                trade_id=pl.when(pl.col("trade") == "i").then(1).otherwise(2),
            )

jp_df
```

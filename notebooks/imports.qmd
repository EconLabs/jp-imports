---
title: "Developing download"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
import polars as pl
from datetime import datetime
```

```{python}
df = pl.read_csv("data/raw/export.csv")
df = df.with_columns(pl.when(pl.col("month") > 6).then(pl.col("year") + 1).otherwise(pl.col("year")).alias("fiscal_year"))
df = df.group_by("fiscal_year").agg(pl.sum("value").alias("date"))
df.sort("fiscal_year")
```

```{python}
# main
df = pl.read_csv("data/raw/ftrade_all_iepr.csv", ignore_errors=True)
df = df.filter(pl.col("Trade") == "e").drop("Trade")
df = df.with_columns(pl.when(pl.col("Month") > 6).then(pl.col("Year") + 1).otherwise(pl.col("Year")).alias("fiscal_year"))
df = df.group_by("fiscal_year").agg(pl.sum("data").alias("date"))
df.sort("fiscal_year")
```

```{python}
df = pl.read_parquet("data/raw/census_exports.parquet")
df = df.filter((pl.col("comm_level") == "HS6") & (pl.col("country_name") == "TOTAL FOR ALL COUNTRIES"))
df = df.with_columns(pl.when(pl.col("date").dt.year() > 6).then(pl.col("date").dt.year() + 1).otherwise(pl.col("date").dt.year()).alias("fiscal_year"))
df = df.group_by("fiscal_year").agg(pl.sum("census_value").alias("data"))
df.sort("fiscal_year")
```



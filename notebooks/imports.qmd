---
title: "Developing download"
format:
  html:
    code-fold: true
jupyter: python3
---

```{python}
import os
os.chdir("..")
```

```{python}
import polars as pl
from src.jp_imports.data_process import DataProcess
```

```{python}
df = pl.read_csv("data/raw/export.csv")
df = df.with_columns(pl.when(pl.col("month") > 6).then(pl.col("year") + 1).otherwise(pl.col("year")).alias("fiscal_year"))
df = df.group_by("fiscal_year").agg(pl.sum("value").alias("date"))
df.sort("fiscal_year")
```

```{python}
# main
df = pl.read_parquet("data/raw/jp_instance.parquet")
df = df.filter(pl.col("Trade") == "e").drop("Trade")
df = df.filter(pl.col("naics") != "RETURN")
df = df.with_columns(pl.when(pl.col("Month") > 6).then(pl.col("Year") + 1).otherwise(pl.col("Year")).alias("fiscal_year"))
df = df.group_by("fiscal_year").agg(pl.sum("data").alias("data"))
df = df.with_columns(data=pl.col("data")/1000000)
df.sort("fiscal_year")
```

```{python}
df = DataProcess(saving_dir="data/", instance="jp_instetute", debug=True).process_int_jp(time="fiscal", types="total")
df
```


